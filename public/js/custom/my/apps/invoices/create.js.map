{"version":3,"file":"create.js","names":["AppInvoicesCreate","form","updateTotal","items","slice","call","querySelectorAll","grandTotal","format","wNumb","decimals","thousand","map","item","quantity","querySelector","price","priceValue","from","value","quantityValue","parseInt","to","innerText","handleEmptyState","length","cloneNode","appendChild","Util","remove","init","element","document","addEventListener","e","preventDefault","on","this","closest","$","flatpickr","enableTime","dateFormat","onDOMContentLoaded"],"sources":["my/apps/invoices/create.js"],"mappings":"AAAA,aAGA,IAAIA,kBAAoB,WACpB,IAAIC,EAGHC,EAAc,WACjB,IAAIC,EAAQ,GAAGC,MAAMC,KAAKJ,EAAKK,iBAAiB,iDAC5CC,EAAa,EAEbC,EAASC,MAAM,CAElBC,SAAU,EACVC,SAAU,MAGXR,EAAMS,KAAI,SAAUC,GACV,IAAIC,EAAWD,EAAKE,cAAc,6BACvCC,EAAQH,EAAKE,cAAc,0BAE3BE,EAAaT,EAAOU,KAAKF,EAAMG,OACnCF,GAAeA,GAAcA,EAAa,EAAK,EAAIA,EAEnD,IAAIG,EAAgBC,SAASP,EAASK,OACtCC,GAAkBA,GAAiBA,EAAgB,EAAM,EAAIA,EAE7DJ,EAAMG,MAAQX,EAAOc,GAAGL,GACxBH,EAASK,MAAQC,EAEjBP,EAAKE,cAAc,0BAA0BQ,UAAYf,EAAOc,GAAGL,EAAaG,GAEhFb,GAAcU,EAAaG,CAC5B,IAEAnB,EAAKc,cAAc,8BAA8BQ,UAAYf,EAAOc,GAAGf,GACvEN,EAAKc,cAAc,gCAAgCQ,UAAYf,EAAOc,GAAGf,EAC1E,EAEIiB,EAAmB,WACtB,GAAqF,IAAjFvB,EAAKK,iBAAiB,gDAAgDmB,OAAc,CACvF,IAAIZ,EAAOZ,EAAKc,cAAc,sCAAsCW,WAAU,GAC9EzB,EAAKc,cAAc,gCAAgCY,YAAYd,EAChE,MACCe,KAAKC,OAAO5B,EAAKc,cAAc,iDAEjC,EAkDA,MAAO,CACNe,KAAM,SAASC,IACL9B,EAAO+B,SAASjB,cAAc,kBAhDnCA,cAAc,oDAAoDkB,iBAAiB,SAAS,SAASC,GACzGA,EAAEC,iBAEF,IAAItB,EAAOZ,EAAKc,cAAc,qCAAqCW,WAAU,GAE7EzB,EAAKc,cAAc,gCAAgCY,YAAYd,GAE/DW,IACAtB,GACD,IAGA0B,KAAKQ,GAAGnC,EAAM,sDAAuD,SAAS,SAASiC,GACtFA,EAAEC,iBAEFP,KAAKC,OAAOQ,KAAKC,QAAQ,0BAEzBd,IACAtB,GACD,IAGA0B,KAAKQ,GAAGnC,EAAM,kGAAmG,UAAU,SAASiC,GACnIA,EAAEC,iBAEFjC,GACD,IAKkBqC,EAAEtC,EAAKc,cAAc,0BAC3ByB,UAAU,CACrBC,YAAY,EACZC,WAAY,WAICH,EAAEtC,EAAKc,cAAc,8BAC3ByB,UAAU,CACjBC,YAAY,EACZC,WAAY,WAWZxC,GACK,EAER,CAtGwB,GAyGxB0B,KAAKe,oBAAmB,WACpB3C,kBAAkB8B,MACtB","sourcesContent":["\"use strict\";\r\n\r\n// Определение класса\r\nvar AppInvoicesCreate = function () {\r\n    var form;\r\n\r\n\t// Приватные методы\r\n\tvar updateTotal = function() {\r\n\t\tvar items = [].slice.call(form.querySelectorAll('[data-element=\"items\"] [data-element=\"item\"]'));\r\n\t\tvar grandTotal = 0;\r\n\r\n\t\tvar format = wNumb({\r\n\t\t\t//prefix: '$ ',\r\n\t\t\tdecimals: 2,\r\n\t\t\tthousand: ','\r\n\t\t});\r\n\r\n\t\titems.map(function (item) {\r\n            var quantity = item.querySelector('[data-element=\"quantity\"]');\r\n\t\t\tvar price = item.querySelector('[data-element=\"price\"]');\r\n\r\n\t\t\tvar priceValue = format.from(price.value);\r\n\t\t\tpriceValue = (!priceValue || priceValue < 0) ? 0 : priceValue;\r\n\r\n\t\t\tvar quantityValue = parseInt(quantity.value);\r\n\t\t\tquantityValue = (!quantityValue || quantityValue < 0) ?  1 : quantityValue;\r\n\r\n\t\t\tprice.value = format.to(priceValue);\r\n\t\t\tquantity.value = quantityValue;\r\n\r\n\t\t\titem.querySelector('[data-element=\"total\"]').innerText = format.to(priceValue * quantityValue);\t\t\t\r\n\r\n\t\t\tgrandTotal += priceValue * quantityValue;\r\n\t\t});\r\n\r\n\t\tform.querySelector('[data-element=\"sub-total\"]').innerText = format.to(grandTotal);\r\n\t\tform.querySelector('[data-element=\"grand-total\"]').innerText = format.to(grandTotal);\r\n\t}\r\n\r\n\tvar handleEmptyState = function() {\r\n\t\tif (form.querySelectorAll('[data-element=\"items\"] [data-element=\"item\"]').length === 0) {\r\n\t\t\tvar item = form.querySelector('[data-element=\"empty-template\"] tr').cloneNode(true);\r\n\t\t\tform.querySelector('[data-element=\"items\"] tbody').appendChild(item);\r\n\t\t} else {\r\n\t\t\tUtil.remove(form.querySelector('[data-element=\"items\"] [data-element=\"empty\"]'));\r\n\t\t}\r\n\t}\r\n\r\n\tvar handeForm = function (element) {\r\n\t\t// Add item\r\n\t\tform.querySelector('[data-element=\"items\"] [data-element=\"add-item\"]').addEventListener('click', function(e) {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tvar item = form.querySelector('[data-element=\"item-template\"] tr').cloneNode(true);\r\n\r\n\t\t\tform.querySelector('[data-element=\"items\"] tbody').appendChild(item);\r\n\r\n\t\t\thandleEmptyState();\r\n\t\t\tupdateTotal();\t\t\t\r\n\t\t});\r\n\r\n\t\t// Remove item\r\n\t\tUtil.on(form, '[data-element=\"items\"] [data-element=\"remove-item\"]', 'click', function(e) {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tUtil.remove(this.closest('[data-element=\"item\"]'));\r\n\r\n\t\t\thandleEmptyState();\r\n\t\t\tupdateTotal();\t\t\t\r\n\t\t});\t\t\r\n\r\n\t\t// Handle price and quantity changes\r\n\t\tUtil.on(form, '[data-element=\"items\"] [data-element=\"quantity\"], [data-element=\"items\"] [data-element=\"price\"]', 'change', function(e) {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tupdateTotal();\t\t\t\r\n\t\t});\r\n\t}\r\n\r\n\tvar initForm = function(element) {\r\n\t\t// Due date. For more info, please visit the official plugin site: https://flatpickr.js.org/\r\n\t\tvar invoiceDate = $(form.querySelector('[name=\"invoice_date\"]'));\r\n\t\tinvoiceDate.flatpickr({\r\n\t\t\tenableTime: false,\r\n\t\t\tdateFormat: \"d, M Y\",\r\n\t\t});\r\n\r\n        // Due date. For more info, please visit the official plugin site: https://flatpickr.js.org/\r\n\t\tvar dueDate = $(form.querySelector('[name=\"invoice_due_date\"]'));\r\n\t\tdueDate.flatpickr({\r\n\t\t\tenableTime: false,\r\n\t\t\tdateFormat: \"d, M Y\",\r\n\t\t});\r\n\t}\r\n\r\n\t// Публичные методы\r\n\treturn {\r\n\t\tinit: function(element) {\r\n            form = document.querySelector('#invoice_form');\r\n\r\n\t\t\thandeForm();\r\n            initForm();\r\n\t\t\tupdateTotal();\r\n        }\r\n\t};\r\n}();\r\n\r\n// При загрузке документа\r\nUtil.onDOMContentLoaded(function () {\r\n    AppInvoicesCreate.init();\r\n});\r\n"]}