"use strict";var FIDOSettings=function(){var t,n,o=function(t){let n="=?BINARY?B?",e="?=";if("object"==typeof t)for(let r in t)if("string"==typeof t[r]){let o=t[r];if(o.substring(0,n.length)===n&&o.substring(o.length-e.length)===e){o=o.substring(n.length,o.length-e.length);let a=window.atob(o),i=a.length,s=new Uint8Array(i);for(let t=0;t<i;t++)s[t]=a.charCodeAt(t);t[r]=s.buffer}}else o(t[r])},e=function(t){let n="",o=new Uint8Array(t),e=o.byteLength;for(let t=0;t<e;t++)n+=String.fromCharCode(o[t]);return window.btoa(n)};return{init:function(){try{t=document.getElementById("fido_create"),n=document.getElementById("fido_delete"),(navigator.credentials&&navigator.credentials.create||(swal.fire({text:"Браузер не поддерживается",icon:"error",buttonsStyling:!1,confirmButtonText:"Хорошо!",customClass:{confirmButton:"btn fw-bold btn-light-primary"}}),0))&&(t.addEventListener("click",(function(t){t.preventDefault(),axios.get("/fido/create").then((async function(t){if(t.data.data&&200==t.data.status){console.log(t.data.data),o(t.data.data);const n=await navigator.credentials.create(t.data.data),r={transports:n.response.getTransports?n.response.getTransports():null,clientDataJSON:n.response.clientDataJSON?e(n.response.clientDataJSON):null,attestationObject:n.response.attestationObject?e(n.response.attestationObject):null};console.log(r),axios.post("/fido/create",r).then((function(t){t.data.data&&200==t.data.status?(console.log(t.data.data),swal.fire({text:"Встроенная защита активирована!",icon:"success",buttonsStyling:!1,confirmButtonText:"Хорошо!",customClass:{confirmButton:"btn fw-bold btn-light-primary"}}).then((function(t){location.reload()}))):(console.error(t.data.error,t.data.traces),swal.fire({text:t.data.error??"Неизвестная ошибка",icon:"error",buttonsStyling:!1,confirmButtonText:"Хорошо!",customClass:{confirmButton:"btn fw-bold btn-light-primary"}}))})).catch((function(t){console.error(t),swal.fire({text:"Ошибка FIDO: "+t,icon:"error",buttonsStyling:!1,confirmButtonText:"Хорошо!",customClass:{confirmButton:"btn fw-bold btn-light-primary"}})}))}else console.error(t.data.error,t.data.traces),swal.fire({text:t.data.error??"Неизвестная ошибка",icon:"error",buttonsStyling:!1,confirmButtonText:"Хорошо!",customClass:{confirmButton:"btn fw-bold btn-light-primary"}})})).catch((function(t){console.error(t),swal.fire({text:"Ошибка FIDO: "+t,icon:"error",buttonsStyling:!1,confirmButtonText:"Хорошо!",customClass:{confirmButton:"btn fw-bold btn-light-primary"}})}))})),n&&n.addEventListener("click",(function(t){t.preventDefault(),swal.fire({text:"Вы уверены? Это удалит существующие ключи",icon:"warning",buttonsStyling:!1,showDenyButton:!0,confirmButtonText:"Да, отключить защиту",denyButtonText:"Нет, оставить",customClass:{confirmButton:"btn btn-primary",denyButton:"btn btn-light-danger"}}).then((t=>{t.isConfirmed&&axios.post("/fido/delete").then((async function(t){t.data.data&&200==t.data.status?(console.log(t.data.data),swal.fire({text:"Встроенная защита отключена!",icon:"success",buttonsStyling:!1,confirmButtonText:"Хорошо!",customClass:{confirmButton:"btn fw-bold btn-light-primary"}}).then((function(t){location.reload()}))):(console.error(t.data.error,t.data.traces),swal.fire({text:t.data.error??"Неизвестная ошибка",icon:"error",buttonsStyling:!1,confirmButtonText:"Хорошо!",customClass:{confirmButton:"btn fw-bold btn-light-primary"}}))})).catch((function(t){console.error(t),swal.fire({text:"Проверьте соединение с интернетом или обратитесь к администрации",icon:"error",buttonsStyling:!1,confirmButtonText:"Хорошо!",customClass:{confirmButton:"btn fw-bold btn-light-primary"}})}))}))})))}catch(t){return swal.fire({text:t,icon:"error",buttonsStyling:!1,confirmButtonText:"Хорошо!",customClass:{confirmButton:"btn fw-bold btn-light-primary"}}),!1}}}}();Util.onDOMContentLoaded((function(){FIDOSettings.init()}));
//# sourceMappingURL=fido.js.map
